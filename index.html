<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Á®ÆÂ≠êÂ≥∂ÊñπË®Ä„Éê„Éñ„É´„ÇØ„Ç§„Ç∫</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      background: #000 url("bg.png") no-repeat center center fixed;
      background-size: contain;
      display: flex; justify-content: center; align-items: center;
      height: 100dvh; width: 100vw; overflow: hidden;
    }
    #game {
      height: 95vh; width: min(95vw, calc(95vh * 9 / 16));
      background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px; padding: 3vh 2vh; text-align: center;
      display: flex; flex-direction: column; justify-content: space-between;
      position: relative; z-index: 1;
    }
    h1 { font-size: clamp(20px, 4.5vh, 30px); margin: 0; color: #fff; text-shadow: 2px 2px 4px #000; white-space: nowrap; }
    #status {
      font-size: 2.4vh; color: #fff; background: rgba(0, 0, 0, 0.6);
      padding: 10px 15px; border-radius: 20px; align-self: center;
      display: flex; flex-direction: column; justify-content: center;
      align-items: center; gap: 5px; width: fit-content; min-width: 60%; line-height: 1.2;
    }
    #word { font-size: clamp(18px, 4.5vh, 32px); font-weight: bold; color: #fff; text-shadow: 2px 2px 10px #000; margin: 1vh 0; }
    .choices { display: grid; grid-template-columns: 1fr 1fr; gap: 2vh; width: 100%; flex-grow: 1; align-content: center; }
    .bubble {
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9) 0%, rgba(200, 230, 255, 0.6) 50%, rgba(100, 180, 255, 0.4) 100%);
      border-radius: 50%; aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center;
      padding: 10%; font-size: clamp(20px, 3.6vh, 30px); font-weight: bold;
      box-shadow: inset -5px -5px 15px rgba(0, 0, 0, 0.1), inset 5px 5px 15px rgba(255, 255, 255, 0.8), 0 4px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.5); cursor: pointer; color: #222; line-height: 1.3; transition: transform 0.1s;
    }
    .bubble:active { transform: scale(0.92); }
    .overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 20; }
    #startScreen { background: #000 url("title.png") no-repeat center center; background-size: contain; }
    #resultScreen, #rankScreen { background: rgba(0, 0, 0, 0.85); }
    .panel { background: rgba(255, 255, 255, 0.9); padding: 4vh 20px; border-radius: 20px; width: 80%; max-width: 300px; text-align: center; position: relative; }
    button { padding: 1.5vh 3vh; font-size: clamp(16px, 2.8vh, 24px); font-weight: bold; border: none; border-radius: 15px; background: #ffaa00; color: #fff; box-shadow: 0 5px 0 #cc8800; cursor: pointer; }
    button:active { transform: translateY(3px); box-shadow: none; }
    #startScreen button { font-size: clamp(24px, 4.2vh, 36px); display: block; margin: 0 auto; }
    #startScreen .panel { background: transparent !important; padding: 0; height: auto; display: flex; align-items: center; justify-content: center; }
    #confettiCanvas { position: fixed; inset: 0; pointer-events: none; z-index: 30; }
  </style>
</head>
<body>
  <div id="game">
    <h1>ü´ß Á®ÆÂ≠êÂ≥∂ ÊñπË®Ä„ÇØ„Ç§„Ç∫ ü´ß</h1>
    <div id="status"></div>
    <div id="word"></div>
    <div class="choices" id="choices"></div>
  </div>

  <div id="startScreen" class="overlay">
    <div class="panel" style="margin-top: 30vh;">
      <button onclick="startGameWithAudio()">„Çπ„Çø„Éº„Éà</button>
    </div>
  </div>

  <div id="resultScreen" class="overlay" style="display:none;">
    <div class="panel">
      <div id="resultMessage" style="font-size: 3.5vh; margin-bottom: 2vh; font-weight:bold;"></div>
      <div id="correctAnswer" style="margin-bottom: 3vh; font-size: 3.2vh;"></div>
      <button id="nextBtn" onclick="nextQuiz()">„Å§„Åé„Å∏ ‚ñ∂</button>
    </div>
  </div>

  <div id="rankScreen" class="overlay" style="display:none;">
    <div class="panel">
      <div style="font-size: 1.6vh; color: #666;">Áç≤ÂæóÂæóÁÇπ ÔΩú „ÇØ„É™„Ç¢„Çø„Ç§„É†</div>
      <div style="margin-bottom: 2vh;">
        <span id="finalScore" style="font-size: 4vh; font-weight: bold;"></span>
        <span style="font-size: 2vh; color: #666; margin: 0 5px;">/</span>
        <span id="totalTimeDisplay" style="font-size: 2.5vh; font-weight: bold;"></span>
      </div>
      <div style="font-size: 2vh; color: #666;">Áß∞Âè∑Âêç</div>
      <div id="rankTitle" style="font-size: 3vh; font-weight: bold; color: #d40000; margin-bottom: 2vh;"></div>
      <div id="rankMessage" style="font-size: 1.8vh; line-height: 1.4; margin-bottom: 3vh; background: #eee; padding: 10px; border-radius: 10px;"></div>
      <button onclick="location.reload()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂</button>
    </div>
  </div>

  <canvas id="confettiCanvas"></canvas>

  <script>
    const quizData = [
      { word: "„Ç™„Ç∏„Éº", answer: "Â§´„ÄÅ‰∏ª‰∫∫", audio: "01Oji.mp3" },
      { word: "„Éê„Ç≠„Éº", answer: "Â¶ª„ÄÅÂ••„Åï„Çì", audio: "02Baki.mp3" },
      { word: "„ÉØ„Éº", answer: "„ÅÇ„Å™„Åü„ÄÅÂêõ", audio: "03Wa.mp3" },
      { word: "„ÉØ„É≥„Çø„ÉÅ", answer: "„ÅÇ„Å™„ÅüÈÅî", audio: "04Wantachi.mp3" },
      { word: "„Ç™„Ç§(„Éâ„É≥)", answer: "„Çè„Åü„Åó„ÄÅ‰ø∫", audio: "05Oi.mp3" },
      { word: "„Ç™„Ç§„Çø„ÉÅ („Éâ„É≥„Çø„ÉÅ)", answer: "„Çè„Åü„ÅóÈÅî", audio: "06Oitachi.mp3" },
      { word: "„Ç¢„Ç§„Ç∏„Éß„Éº", answer: "ÂÖÑ„Åï„Çì„ÄÅÂÖàËº©(Áî∑)", audio: "07Aijo.mp3" },
      { word: "„Ç¢„Ç§„Éç„Éº", answer: "Âßâ„Åï„Çì„ÄÅÂÖàËº©(Â•≥)", audio: "08Aine.mp3" },
      { word: "„Ç±„Éä„Ç°„Éº", answer: "Ë¶™Êàö", audio: "09Kena.mp3" },
      { word: "„Ç´„É©„Ç§„É¢", answer: "„Åï„Å§„Åæ„ÅÑ„ÇÇ", audio: "10Karaimo.mp3" },
      { word: "„Ç™„Ç™„ÇÆ", answer: "„Çµ„Éà„Ç¶„Ç≠„Éì", audio: "11Ogi.mp3" },
      { word: "„É¢„Éè„Éü", answer: "„Éñ„ÉÄ„Ç§", audio: "12Mohami.mp3" },
      { word: "„Éà„ÉÉ„Éî„Éº", answer: "È£õ„Å≥È≠ö", audio: "13Toppi.mp3" },
      { word: "„Éü„Éä", answer: "Á£Ø„ÅÆÂ∑ª„ÅçË≤ù", audio: "14Mina.mp3" },
      { word: "„Éê„ÉÉ„ÇØ„Éº", answer: "„Éí„Ç≠„Ç¨„Ç®„É´", audio: "15Bakku.mp3" },
      { word: "„Éê„É≥„ÉÑ„Ç±", answer: "Â§ïÊñπ", audio: "16Bantsuke.mp3" },
      { word: "„Éõ„Éä„ÇØ („Éõ„É°„ÇØ)", answer: "Êöë„ÅÑ", audio: "17Honaku.mp3" },
      { word: "„Éí„É§„Ç´", answer: "ÂØí„ÅÑ„ÄÅÂÜ∑„Åü„ÅÑ", audio: "18Hiyaka.mp3" },
      { word: "„Éè„Ç®„É≥„Ç´„Çº", answer: "ÂçóÈ¢®", audio: "19Haenkaze.mp3" },
      { word: "„É°„ÉÉ„Ç´„É™„É¢„Ç¶„Çµ„É≥", answer: "„Åì„Çì„Å´„Å°„Çè", audio: "20Mekkarimosan.mp3" },
      { word: "„Ç™„Ç∏„É£„É™„É¢„Ç¶„Çª", answer: "„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åõ", audio: "21Ojarimose.mp3" },
      { word: "„Éé„ÉÉ„ÉÅ„Éº„É®", answer: "„Åï„Çà„ÅÜ„Å™„Çâ", audio: "22Notchiyo.mp3" },
      { word: "„Ç™„Éº„Ç≠„Éã", answer: "„ÅÇ„Çä„Åå„Å®„ÅÜ", audio: "23Okini.mp3" },
      { word: "„Ç≠„Éê„É´", answer: "È†ëÂºµ„Çã", audio: "24Kibaru.mp3" },
      { word: "„Ç™„É®„Éä„Ç°", answer: "„Åù„ÅÜ„Å†„Å≠", audio: "25Oyona.mp3" },
      { word: "„Ç¢„Éê„É®„Éº", answer: "È©ö„ÅÑ„Åü„Å®„Åç", audio: "26Abayo.mp3" },
      { word: "„Ç™„É®", answer: "„ÅØ„ÅÑ„ÄÅ‰∫ÜËß£", audio: "27Oyo.mp3" },
      { word: "„Éç„ÇÆ„É´", answer: "Âè±„Çã", audio: "28Negiru.mp3" },
      { word: "„Ç¥„Éº„É©„Ç∑„Ç´", answer: "„Åã„Çè„ÅÑ„Åù„ÅÜ", audio: "29Gorashika.mp3" },
      { word: "„Éä„ÉÉ„Ç∑„Çß„Éº", answer: "„Å©„ÅÜ„Åó„Å¶Ôºü", audio: "30Nasshe.mp3" },
      { word: "„Éè„Éê„Ç∑„Ç´", answer: "Á¥†Êó©„ÅÑ", audio: "31Habashika.mp3" },
      { word: "„Çø„Ç§„ÇΩ„Ç´", answer: "„Åç„Å§„ÅÑ„ÄÅÈõ£ÂÑÄ", audio: "32Taisoka.mp3" },
      { word: "„Éä„Ç™„Çπ", answer: "Áâá‰ªò„Åë„Çã", audio: "33Naosu.mp3" },
      { word: "„Ç´„É´„Éº", answer: "ËÉåË≤†„ÅÜ", audio: "34Karu.mp3" },
      { word: "„É†„Ç∏„Éß„Ç´", answer: "„Åã„Çè„ÅÑ„ÅÑ", audio: "35Mujoka.mp3" },
      { word: "„Ç®„Éº„ÇØ„É©„Éº", answer: "ÈÖî„Å£„Å±„Çâ„ÅÑ", audio: "36Ekura.mp3" },
      { word: "„Ç™„É©„Éñ", answer: "Â§ßÂ£∞„ÇíÂá∫„Åô", audio: "37Orabu.mp3" },
      { word: "„ÉÅ„ÉÉ„Éà", answer: "Â∞ë„Åó", audio: "38Chitto.mp3" },
      { word: "„Çø„Ç§„ÉÅ„Çß", answer: "„Åü„Åè„Åï„Çì", audio: "39Taiche.mp3" }
    ];

    const totalQuestions = 10;
    let questions = []; let current = 0; let score = 0;
    let comboCount = 0;
    let totalThinkingTime = 0;
    let questionStartTime = 0;
    
    const voiceAudio = new Audio();
    const effectAudio = new Audio();

    function playSound(audioObj, src, onEnded) {
      audioObj.pause();
      audioObj.src = src;
      audioObj.currentTime = 0;
      audioObj.onended = onEnded || null;
      audioObj.play().catch(() => { if (onEnded) onEnded(); });
    }

    function shuffle(a) { return a.sort(() => Math.random() - 0.5); }

    function startGameWithAudio() {
      // 00start.mp3 „ÇíÂÜçÁîü„Åó„Å¶„Ç≤„Éº„É†ÈñãÂßãÔºà00_nazo01.mp3„ÅÆÂÅúÊ≠¢Âá¶ÁêÜ„ÅØÂâäÈô§Ê∏à„ÅøÔºâ
      playSound(effectAudio, "00start.mp3", () => {
        document.getElementById("startScreen").style.display = "none";
        questions = shuffle([...quizData]).slice(0, totalQuestions);
        current = 0; score = 0; comboCount = 0; totalThinkingTime = 0;
        loadQuiz();
      });
    }

    function loadQuiz() {
      playSound(effectAudio, "00mondai.mp3");
      const q = questions[current];
      const comboRow = comboCount > 0 ? `<div>ü´ß√ó${comboCount} „Ç≥„É≥„ÉúÔºÅ</div>` : "<div>&nbsp;</div>";
      document.getElementById("status").innerHTML = `
        <div>üéØ ${current + 1} / ${totalQuestions} ÔΩú üöÄ ${score}</div>
        ${comboRow}
      `;
      document.getElementById("word").textContent = `„Äå${q.word}„Äç„ÅÆÊÑèÂë≥„ÅØÔºü`;

      let choices = shuffle(quizData.map(x => x.answer).filter(a => a !== q.answer)).slice(0, 3);
      choices.push(q.answer);
      choices = shuffle(choices);

      const box = document.getElementById("choices");
      box.innerHTML = "";
      choices.forEach(c => {
        const div = document.createElement("div");
        div.className = "bubble";
        div.textContent = c;
        div.onclick = () => checkAnswer(c);
        box.appendChild(div);
      });
      questionStartTime = Date.now();
    }

    function checkAnswer(choice) {
      const responseTime = (Date.now() - questionStartTime) / 1000;
      totalThinkingTime += responseTime;

      const q = questions[current];
      const isCorrect = choice === q.answer;
      const result = document.getElementById("resultScreen");

      if (isCorrect) {
        let addedScore = 10 * Math.pow(2, comboCount);
        score += addedScore;
        comboCount++;
        document.getElementById("resultMessage").textContent = `‚≠ï Ê≠£Ëß£ÔºÅ +${addedScore}`;
        
        playSound(effectAudio, "00seikai.mp3");
        if (q.audio) {
          playSound(voiceAudio, q.audio, () => {
            document.getElementById("nextBtn").style.visibility = "visible";
          });
        } else {
          document.getElementById("nextBtn").style.visibility = "visible";
        }
      } else {
        comboCount = 0;
        document.getElementById("resultMessage").textContent = "‚ùå „Åñ„Çì„Å≠„Çì‚Ä¶";
        playSound(effectAudio, "00hazure.mp3", () => {
          document.getElementById("nextBtn").style.visibility = "visible";
        });
      }

      document.getElementById("correctAnswer").textContent = `Ê≠£Ëß£Ôºö${q.answer}`;
      result.style.display = "flex";
      document.getElementById("nextBtn").style.visibility = "hidden";
    }

    function nextQuiz() {
      document.getElementById("resultScreen").style.display = "none";
      current++;
      if (current < totalQuestions) loadQuiz();
      else showRank();
    }

    function showRank() {
      const fanfare = new Audio("00_fanfare.ogg");
      fanfare.volume = 0.5;
      fanfare.play();
      
      const rankScreen = document.getElementById("rankScreen");
      document.getElementById("finalScore").textContent = `${score} ÁÇπ`;
      document.getElementById("totalTimeDisplay").textContent = `${totalThinkingTime.toFixed(2)} Áßí`;

      const title = document.getElementById("rankTitle");
      const msg = document.getElementById("rankMessage");
      let rank = 0;
      if (score >= 8001) { rank = 3; title.textContent = "‰ºùË™¨„ÅÆÁ®ÆÂ≠êÂ≥∂Ë™û„ÇäÈÉ®"; msg.textContent = "„ÅÇ„Å£„Å±„ÇåÔºÅ„ÅÇ„Å™„Åü„ÅØ„ÇÇ„ÅÜÂ≥∂„ÅÆ‰∫∫„ÇÇÈ©ö„Åè„Åª„Å©„ÅÆÊñπË®Ä„Éû„Çπ„Çø„Éº„ÄÇ"; }
      else if (score >= 3001) { rank = 2; title.textContent = "H3„É≠„Ç±„ÉÉ„ÉàÁ¥ö„ÅÆÁ≤æÈã≠"; msg.textContent = "Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅË®ÄËëâ„ÅÆÊâì„Å°‰∏ä„ÅíÊàêÂäüÁéá„ÅØÊäúÁæ§„Åß„Åô„ÄÇ"; }
      else if (score >= 1001) { rank = 1; title.textContent = "ÂÆâÁ¥ç„ÅÑ„ÇÇÁ¥ö„ÅÆÁîòÁÜüËÄÖ"; msg.textContent = "„Åã„Å™„ÇäË©≥„Åó„ÅÑ„Åß„Åô„Å≠„ÄÇÂ≥∂„ÅÆË®ÄËëâ„ÅÆÊ∑±„Åø„ÅåÁÜü„Åó„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ"; }
      else if (score >= 301) { rank = 1; title.textContent = "ÈâÑÁ†≤‰ºùÊù•„ÅÆÈñÄ‰∏ãÁîü"; msg.textContent = "Âü∫Á§é„ÅØ„Éê„ÉÉ„ÉÅ„É™„ÄÇÊñ∞„Åó„ÅÑË®ÄËëâ„ÅÆË°ùÊíÉ„ÇíÂê∏Âèé„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜÔºÅ"; }
      else { rank = 0; title.textContent = "„Çà„Åã„Çà„ÅãË¶≥ÂÖâÁîü"; msg.textContent = "„Åæ„Åö„ÅØÂ≥∂„ÇíÊ•Ω„Åó„ÇÄ„Åì„Å®„Åã„ÇâÔºÅ„Äå„Çà„Åã„Çà„Åã„Äç„ÅÆÁ≤æÁ•û„Åß„ÄÇ"; }

      rankScreen.style.display = "flex";
      if (rank > 0) startConfetti(rank);
    }

    function startConfetti(intensity) {
      const canvas = document.getElementById("confettiCanvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let particles = [];
      const colors = ["#FFC700", "#FF0000", "#2E3192", "#00AEEF", "#ED1C24", "#FFF"];
      for (let i = 0; i < intensity * 50; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          size: Math.random() * 8 + 4,
          color: colors[Math.floor(Math.random() * colors.length)],
          speed: Math.random() * 3 + 2,
          angle: Math.random() * 6.28,
          rotationSpeed: Math.random() * 0.1
        });
      }
      function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          p.y += p.speed; p.angle += p.rotationSpeed;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.angle);
          ctx.fillStyle = p.color; ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
          ctx.restore();
          if (p.y > canvas.height) p.y = -20;
        });
        requestAnimationFrame(update);
      }
      update();
    }
  </script>
</body>
</html>